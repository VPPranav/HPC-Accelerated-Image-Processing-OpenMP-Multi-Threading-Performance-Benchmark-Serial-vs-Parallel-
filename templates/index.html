<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HPC Image Processing Benchmark Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 50%, #0f1729 100%);
    color: #e5e7eb;
    min-height: 100vh;
    padding: 20px;
    position: relative;
    overflow-x: hidden;
}

body::before {
    content: '';
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(14, 165, 233, 0.05) 1px, transparent 1px);
    background-size: 50px 50px;
    animation: gridMove 20s linear infinite;
    pointer-events: none;
    z-index: 0;
}

@keyframes gridMove {
    0% { transform: translate(0, 0); }
    100% { transform: translate(50px, 50px); }
}

.container {
    max-width: 1600px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
}

header {
    text-align: center;
    margin-bottom: 40px;
    padding: 30px;
    background: linear-gradient(135deg, rgba(14, 165, 233, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
    border-radius: 20px;
    border: 1px solid rgba(14, 165, 233, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(14, 165, 233, 0.2);
}

h1 {
    font-size: 3em;
    background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 50%, #ec4899 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 10px;
    text-shadow: 0 0 30px rgba(14, 165, 233, 0.5);
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from { filter: drop-shadow(0 0 5px rgba(14, 165, 233, 0.5)); }
    to { filter: drop-shadow(0 0 20px rgba(14, 165, 233, 0.8)); }
}

.subtitle {
    font-size: 1.2em;
    color: #94a3b8;
    font-weight: 300;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.6) 100%);
    border-radius: 15px;
    padding: 25px;
    border: 1px solid rgba(14, 165, 233, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(14, 165, 233, 0.1), transparent);
    transition: left 0.5s;
}

.stat-card:hover::before {
    left: 100%;
}

.stat-card:hover {
    transform: translateY(-5px);
    border-color: rgba(14, 165, 233, 0.6);
    box-shadow: 0 12px 40px rgba(14, 165, 233, 0.3);
}

.stat-label {
    font-size: 0.9em;
    color: #94a3b8;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.stat-value {
    font-size: 2em;
    font-weight: bold;
    background: linear-gradient(135deg, #0ea5e9 0%, #6366f1 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.stat-icon {
    font-size: 2em;
    position: absolute;
    right: 20px;
    top: 20px;
    opacity: 0.3;
}

.grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 25px;
    margin-bottom: 30px;
}

.card {
    background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.7) 100%);
    border-radius: 20px;
    padding: 30px;
    border: 1px solid rgba(14, 165, 233, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    transition: all 0.3s ease;
}

.card:hover {
    border-color: rgba(14, 165, 233, 0.6);
    box-shadow: 0 12px 40px rgba(14, 165, 233, 0.3);
}

.card.full-width {
    grid-column: 1 / -1;
}

h2 {
    color: #38bdf8;
    margin-bottom: 20px;
    font-size: 1.8em;
    display: flex;
    align-items: center;
    gap: 10px;
}

h3 {
    color: #60a5fa;
    margin-bottom: 15px;
    font-size: 1.3em;
}

.metric {
    display: flex;
    justify-content: space-between;
    margin-bottom: 12px;
    padding: 10px;
    background: rgba(14, 165, 233, 0.05);
    border-radius: 8px;
    border-left: 3px solid #0ea5e9;
    transition: all 0.3s ease;
}

.metric:hover {
    background: rgba(14, 165, 233, 0.1);
    transform: translateX(5px);
}

.metric span:first-child {
    color: #94a3b8;
    font-weight: 500;
}

.metric span:last-child {
    font-weight: bold;
    color: #e5e7eb;
}

.explain {
    font-size: 0.95em;
    color: #cbd5e1;
    margin-top: 20px;
    border-left: 4px solid #0ea5e9;
    padding: 15px 20px;
    background: rgba(14, 165, 233, 0.1);
    border-radius: 8px;
    line-height: 1.6;
}

.highlight {
    color: #22c55e;
    font-weight: bold;
    font-size: 1.2em;
}

.chart-container {
    position: relative;
    height: 350px;
    margin-top: 20px;
}

.footer {
    margin-top: 40px;
    text-align: center;
    font-size: 0.9em;
    color: #64748b;
    padding: 20px;
    background: rgba(15, 23, 42, 0.5);
    border-radius: 15px;
    border: 1px solid rgba(14, 165, 233, 0.2);
}

.pulse {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: #22c55e;
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

@media (max-width: 1024px) {
    .grid {
        grid-template-columns: 1fr;
    }
    h1 {
        font-size: 2em;
    }
}

.badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85em;
    font-weight: 600;
    margin-left: 10px;
}

.badge-success {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
    border: 1px solid #22c55e;
}

.badge-info {
    background: rgba(14, 165, 233, 0.2);
    color: #0ea5e9;
    border: 1px solid #0ea5e9;
}
</style>
</head>

<body>

<div class="container">
    <header>
        <h1>üöÄ HPC PARALLEL IMAGE PROCESSING</h1>
        <p class="subtitle">Real-time Performance Analytics & Benchmark Dashboard</p>
    </header>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">‚ö°</div>
            <div class="stat-label">Speedup Factor</div>
            <div class="stat-value" id="speedup-stat">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üìä</div>
            <div class="stat-label">Efficiency</div>
            <div class="stat-value" id="efficiency-stat">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üíª</div>
            <div class="stat-label">CPU Utilization</div>
            <div class="stat-value" id="cpu-stat">--</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üéØ</div>
            <div class="stat-label">Throughput Boost</div>
            <div class="stat-value" id="throughput-stat">--</div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <h2>üßµ Serial Execution <span class="badge badge-info">Single Thread</span></h2>
            <div id="serial"></div>
        </div>
        <div class="card">
            <h2>‚ö° OpenMP Parallel <span class="badge badge-success">Multi-Thread</span></h2>
            <div id="parallel"></div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <h3>üìà Performance Speedup Comparison</h3>
            <div class="chart-container">
                <canvas id="speedupChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h3>üíæ CPU Utilization Analysis</h3>
            <div class="chart-container">
                <canvas id="cpuChart"></canvas>
            </div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <h3>üî• Throughput Performance (Pixels/sec)</h3>
            <div class="chart-container">
                <canvas id="throughputChart"></canvas>
            </div>
        </div>
        <div class="card">
            <h3>‚è±Ô∏è Execution Time Breakdown</h3>
            <div class="chart-container">
                <canvas id="timeChart"></canvas>
            </div>
        </div>
    </div>

    <div class="card full-width" id="comparison"></div>

    <div class="footer">
        <span class="pulse"></span>
        <strong>Live Data</strong> - Auto-refreshes every 5 seconds | Source: results/logs/*.json
    </div>
</div>

<script>
let charts = {};

const chartConfig = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
        legend: {
            labels: {
                color: '#e5e7eb',
                font: { size: 12 }
            }
        }
    },
    scales: {
        y: {
            ticks: { color: '#94a3b8' },
            grid: { color: 'rgba(148, 163, 184, 0.1)' }
        },
        x: {
            ticks: { color: '#94a3b8' },
            grid: { color: 'rgba(148, 163, 184, 0.1)' }
        }
    }
};

async function loadJSON(url) {
    const res = await fetch(url);
    return res.json();
}

function renderMetrics(title, data) {
    let html = '';
    for (const [k, v] of Object.entries(data.metrics || {})) {
        html += `
            <div class="metric">
                <span>${k}</span>
                <span>${v}</span>
            </div>`;
    }
    return html;
}

function createSpeedupChart(compare) {
    const ctx = document.getElementById('speedupChart');
    if (charts.speedup) charts.speedup.destroy();
    
    charts.speedup = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Wall Time', 'User Time', 'System Time'],
            datasets: [{
                label: 'Speedup Factor (√ó)',
                data: [
                    compare.speedup_wall_time || 0,
                    compare.speedup_user_time || 0,
                    compare.speedup_sys_time || 0
                ],
                backgroundColor: [
                    'rgba(14, 165, 233, 0.7)',
                    'rgba(99, 102, 241, 0.7)',
                    'rgba(236, 72, 153, 0.7)'
                ],
                borderColor: [
                    'rgba(14, 165, 233, 1)',
                    'rgba(99, 102, 241, 1)',
                    'rgba(236, 72, 153, 1)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            ...chartConfig,
            plugins: {
                ...chartConfig.plugins,
                title: {
                    display: false
                }
            }
        }
    });
}

function createCPUChart(compare) {
    const ctx = document.getElementById('cpuChart');
    if (charts.cpu) charts.cpu.destroy();
    
    charts.cpu = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['CPU Utilization', 'Efficiency', 'Thread Usage'],
            datasets: [
                {
                    label: 'Serial',
                    data: [
                        compare.serial_cpu_utilization || 0,
                        20,
                        10
                    ],
                    backgroundColor: 'rgba(239, 68, 68, 0.2)',
                    borderColor: 'rgba(239, 68, 68, 1)',
                    borderWidth: 2
                },
                {
                    label: 'Parallel',
                    data: [
                        compare.parallel_cpu_utilization || 0,
                        (compare.parallel_efficiency || 0) * 100,
                        100
                    ],
                    backgroundColor: 'rgba(34, 197, 94, 0.2)',
                    borderColor: 'rgba(34, 197, 94, 1)',
                    borderWidth: 2
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#e5e7eb',
                        font: { size: 12 }
                    }
                }
            },
            scales: {
                r: {
                    ticks: { color: '#94a3b8', backdropColor: 'transparent' },
                    grid: { color: 'rgba(148, 163, 184, 0.2)' },
                    pointLabels: { color: '#94a3b8' }
                }
            }
        }
    });
}

function createThroughputChart(compare) {
    const ctx = document.getElementById('throughputChart');
    if (charts.throughput) charts.throughput.destroy();
    
    charts.throughput = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Serial', 'Parallel'],
            datasets: [{
                data: [
                    compare.serial_pixels_per_sec || 0,
                    compare.parallel_pixels_per_sec || 0
                ],
                backgroundColor: [
                    'rgba(239, 68, 68, 0.7)',
                    'rgba(34, 197, 94, 0.7)'
                ],
                borderColor: [
                    'rgba(239, 68, 68, 1)',
                    'rgba(34, 197, 94, 1)'
                ],
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#e5e7eb',
                        font: { size: 12 }
                    }
                }
            }
        }
    });
}

function createTimeChart(serial, parallel) {
    const ctx = document.getElementById('timeChart');
    if (charts.time) charts.time.destroy();
    
    // Extract time values from metrics
    const serialWall = parseFloat((serial.metrics?.wall_time || '0s').replace('s', ''));
    const serialUser = parseFloat((serial.metrics?.user_time || '0s').replace('s', ''));
    const parallelWall = parseFloat((parallel.metrics?.wall_time || '0s').replace('s', ''));
    const parallelUser = parseFloat((parallel.metrics?.user_time || '0s').replace('s', ''));
    
    charts.time = new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Wall Time', 'User Time', 'System Time'],
            datasets: [
                {
                    label: 'Serial (seconds)',
                    data: [
                        serialWall,
                        serialUser,
                        parseFloat((serial.metrics?.sys_time || '0s').replace('s', ''))
                    ],
                    borderColor: 'rgba(239, 68, 68, 1)',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Parallel (seconds)',
                    data: [
                        parallelWall,
                        parallelUser,
                        parseFloat((parallel.metrics?.sys_time || '0s').replace('s', ''))
                    ],
                    borderColor: 'rgba(34, 197, 94, 1)',
                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                    borderWidth: 3,
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: chartConfig
    });
}

function explainComparison(c) {
    return `
    <h2>üìä Comprehensive Performance Analysis</h2>

    <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
        <div class="metric">
            <span>Wall-time Speedup</span>
            <span class="highlight">${(c.speedup_wall_time || 0).toFixed(2)}√ó</span>
        </div>
        <div class="metric">
            <span>User-time Speedup</span>
            <span class="highlight">${(c.speedup_user_time || 0).toFixed(2)}√ó</span>
        </div>
        <div class="metric">
            <span>System-time Speedup</span>
            <span class="highlight">${(c.speedup_sys_time || 0).toFixed(2)}√ó</span>
        </div>
    </div>

    <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
        <div class="metric">
            <span>Parallel Efficiency</span>
            <span>${((c.parallel_efficiency || 0) * 100).toFixed(1)}%</span>
        </div>
        <div class="metric">
            <span>Performance Gain</span>
            <span class="highlight">${(((c.speedup_wall_time || 1) - 1) * 100).toFixed(1)}%</span>
        </div>
    </div>

    <h3>üî¨ Throughput Metrics</h3>
    <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
        <div class="metric">
            <span>Serial Pixels/sec</span>
            <span>${(c.serial_pixels_per_sec || 0).toLocaleString()}</span>
        </div>
        <div class="metric">
            <span>Parallel Pixels/sec</span>
            <span class="highlight">${(c.parallel_pixels_per_sec || 0).toLocaleString()}</span>
        </div>
    </div>

    <h3>üíª CPU Resource Utilization</h3>
    <div class="grid" style="grid-template-columns: repeat(2, 1fr); gap: 15px;">
        <div class="metric">
            <span>Serial CPU Utilization</span>
            <span>${(c.serial_cpu_utilization || 0).toFixed(2)}</span>
        </div>
        <div class="metric">
            <span>Parallel CPU Utilization</span>
            <span class="highlight">${(c.parallel_cpu_utilization || 0).toFixed(2)}</span>
        </div>
    </div>

    <div class="explain">
        <strong>üéØ Key Performance Insights:</strong><br><br>
        <strong>‚úì Speedup Analysis:</strong> A ${(c.speedup_wall_time || 0).toFixed(2)}√ó speedup indicates ${(c.speedup_wall_time || 0) > 5 ? 'excellent' : 'moderate'} parallelization efficiency. This demonstrates effective utilization of multiple CPU cores for concurrent image processing tasks.<br><br>
        <strong>‚úì CPU Utilization:</strong> Parallel CPU utilization of ${(c.parallel_cpu_utilization || 0).toFixed(2)} (${(c.parallel_cpu_utilization || 0) > 1 ? '>1.0' : '<1.0'}) confirms ${(c.parallel_cpu_utilization || 0) > 1 ? 'multiple cores are actively processing workloads' : 'limited multi-core engagement'}. Higher values indicate better thread distribution across available cores.<br><br>
        <strong>‚úì Efficiency Metrics:</strong> Parallel efficiency of ${((c.parallel_efficiency || 0) * 100).toFixed(1)}% represents the ratio of actual speedup to theoretical maximum. ${(c.parallel_efficiency || 0) > 0.3 ? 'This is realistic for memory-intensive image processing pipelines with I/O overhead.' : 'Consider optimizing memory access patterns and reducing synchronization overhead.'}<br><br>
        <strong>‚úì Throughput Performance:</strong> Parallel processing achieves ${(c.parallel_pixels_per_sec || 0).toLocaleString()} pixels/sec compared to ${(c.serial_pixels_per_sec || 0).toLocaleString()} pixels/sec in serial mode, representing a ${(((c.parallel_pixels_per_sec || 0) / (c.serial_pixels_per_sec || 1) - 1) * 100).toFixed(1)}% throughput improvement.
    </div>
    `;
}

async function refresh() {
    try {
        const [serial, parallel, compare] = await Promise.all([
            loadJSON("/api/serial"),
            loadJSON("/api/parallel"),
            loadJSON("/api/compare")
        ]);

        // Update metric cards
        const comp = compare.comparison || {};
        document.getElementById("speedup-stat").textContent = 
            (comp.speedup_wall_time || 0).toFixed(2) + '√ó';
        document.getElementById("efficiency-stat").textContent = 
            ((comp.parallel_efficiency || 0) * 100).toFixed(1) + '%';
        document.getElementById("cpu-stat").textContent = 
            (comp.parallel_cpu_utilization || 0).toFixed(2);
        document.getElementById("throughput-stat").textContent = 
            (((comp.parallel_pixels_per_sec || 0) / (comp.serial_pixels_per_sec || 1))).toFixed(2) + '√ó';

        // Update metrics tables
        document.getElementById("serial").innerHTML = renderMetrics("üßµ Serial Execution", serial);
        document.getElementById("parallel").innerHTML = renderMetrics("‚ö° OpenMP Parallel Execution", parallel);
        document.getElementById("comparison").innerHTML = explainComparison(comp);

        // Create/update charts
        createSpeedupChart(comp);
        createCPUChart(comp);
        createThroughputChart(comp);
        createTimeChart(serial, parallel);
    } catch (error) {
        console.error("Error loading data:", error);
    }
}

// Initial load and auto-refresh
refresh();
setInterval(refresh, 5000);
</script>

</body>
</html>
